---
title: 最大流
date: 2021-01-08 18:18:31
categories:
- AlgorithmsThinking
- MaximumFlow
cover: false
top_img: https://s3.ax1x.com/2021/01/08/sKV0Fe.jpg
toc: false
mathjax: true
tags:
---

纪念我今天考完的通信网，泪目。虽然这是很久前写的，而且还没写完。。。

渲染出来它就是坨💩啊，泪目！

### 最大流

#### 流网络和流

##### 流网络

**流网络** $G = (V,E)$ 是一个有向图。

图中每条边 $(u,v) \in E$ 有一个非负的 **容量值** $c(u,v)\geq 0$ 。且如果边集合 $E$ 包含一条边 $(u,v)$ ，则图中不存在其反向的边 $(v,u)$ 。如果 $(u,v) \notin E$ ，为方便定义 $c(u,v) = 0$ ，并且在图中**不允许自循环**。

在流网络的所有结点中，特别分辨出两个特殊的结点：**源结点 $s$** 和**汇点 $t$ **。 

流网络是**连通的**。

##### 流

现在给出流的形式化定义：

设 $G = (V,E)$ 为一个流网络，其**容量函数**为 $c$ 。设 $s$ 为流网络的源结点，$t$ 为汇点。$G$ 中的~~(一个)~~**流**(这里的流应该就只是结点到结点的流量)是一个实值函数 $f:V\times V\rightarrow R$   ，满足小面的两条性质：

**容量限制：**对于所有的结点 $u,v \in V$ , 需满足 $0\le f(u,v)\le c(u,v)$。

**流量守恒：**对于所有的结点 $u\in V-\{s,t\}$ ，需满足：$\sum_{v\in V}f(v,u) = \sum_{v\in V}f(u,v)$  

当 $(u,v)\notin E$ 时，从结点 $u$ 到 $v$ 之间没有流，因此 $f(u,v) = 0$ 。（ 对应于上文中 ”如果 $(u,v) \notin E$ ，为方便定义 $c(u,v) = 0$ “  ）

我们称非负数值 $f(u,v)$为结点 $u$ 到 $v$ 的**流**。 **一个流** $f$ 的值 $|\,f\, |$ 定义为：   $|f| = \sum_{v\in V}f(s,v) - \sum_{v\in V}f(v,s)$ ，$s$ 为源点，通常一个流网络不会有任何进入源结点的边，因此**在流网络中**  $\sum_{v\in V}f(v,s) = 0$ ，此时$|f| = \sum_{v\in V}f(s,v)$ ，在我看来，$f(u,v)$ 是边的流量，$|f|$ 是流网络$G$的总流量$f$的值。$|f|$ 是关于 $f(s,v)\,(v\in V)$ 的函数，对于一个确定点 $v\,(v\in V)$ ，$f(s,v)$ 可以有不同的取值，而我们在最大流中要解决的问题就是**求所有 $|f|$ 中的最大值 $|f|_{max}$ **。

#### Ford-Fulkerson 方法

##### 残存网络

给定 流网络 $G$ 和流量 $f$  确定唯一一个残存网络 $G_f$ 。 

###### 残存容量

定义边 $(u,v)$ 的残存容量为 $c_f(u,v)$ 。

对于一个残存网络，直观上有：

$c_f(u,v) = \begin{cases} c(u,v)-f(u,v) \quad if(u,v)\in E \\ f(v,u) \quad if(u,v)\notin E \\ 0 \quad else   \end{cases}$

对于一个流网络 $G(V,E)$ 和一个流 $f$ ，由 $f$ 所**诱导**的图$G$的残存网络为$G_f=(V,E_f)$ ，其中$E_f=\{(u,v)\in V\times V:c_f(u,v)>0\}$ ，$E_f$ 相比 $E$ 多了反向边。

**注意**，残存网络 $G_f$ 类似于一个容量为 $c_f$ 的流网络，但该网络并不满足我们对流网络的定义，因为它可能包含边 $(u,v)$ 和它的反向边 $(v,u)$ 。除了这个区别外，残存网络具有与流网络同样的性质，我们可以**在残存网络中定义一个流**，它满足流的定义，但是针对的是残存网络 $G_f$ 中的容量 $c_f$ 。

如果$f$是$G$的一个流，$f'$是对应残存网络$G_f$中的一个流，定义 $f\uparrow f'$ 为流 $f'$ 对流 $f$ 的**递增**，意义上$f\uparrow f'$是网络流$G$和“网络流”$G_f$的总流量，即$|f\uparrow f'|=|f|+|f'|$ 。

对于 $f\uparrow f'$ ，它是一个从 $V\times V$ 到 $R$ 的函数，定义为：$(f\uparrow f')(u,v) = \begin{cases}f(u,v)+f'(u,v)-f'(v,u)\quad if(u,v)\in E \\ 0\qquad\qquad\qquad\qquad\qquad\qquad else\end{cases}$

##### 增广路径

给定流网络 $G=(V,E)$ 和流 $f$ ，增广路径 $p$ 是残存网络 $G_f$ 中一条从源结点 $s$ 到汇点 $t$ 的路径。

我们称在一条增广路径 $p$ 上能够为每条边增加的流量的最大值为路径 $p$ 的残存容量，该容量为： $c_f(p)=min\{c_f(u,v):(u,v)属于路径p\}$ 。

##### 流网络的切割

流网络 $G=(V,E)$ 中的一个切割 $(S,T)$ 将结点集合 $V$ 分成 $S$ 和 $T=V-S$ ，其中 $s\in S$ ，$t\in T$ 。若 $f$ 是一个流，则定义横跨切割 $(S,T)$ 的 **净流量 $f(S,T)$ ** 为：

$f(S,T)=\sum_{u\in S}\sum_{v\in T}f(u,v)-\sum_{v\in T}\sum_{u\in S}f(v,u)$ 

**切割$(S,T)$的容量**为：

$c(S,T)=\sum_{u\in S}\sum_{v\in T}c(u,v)$ 

一个网络的最小切割是整个网络中容量最小的切割。

**引理**：设 $f$ 为流网络 $G$ 的一个流，该流的源结点 $s$ ，汇点 $t$ ，设 $(S,T)$ 为流网络 $G$ 的任意切割，则横跨切割 $(S,T)$ 的净流量为 $f(S,T)=|f|$ 。

**推论**：流网络 $G$ 中任意流 $f$ 的值不能超过 $G$ 的任意切割的容量。

以上两个结论从直觉上似乎很好理解。其中，推论说明了可以通过求最小切割容量来求得最大流的值。

**最大流最小切割定理**：

设 $f$ 为流网络 $G=(V,E)$ 中的一个流，该流网络的源结点 $s$ ，汇点 $t$ 。以下条件等价：

1.  $f$ 是 $G$ 的一个最大流。
2. 残存网络 $G_f$ 不包含任何增广路径。
3. $|f|=c(S,T)$ ，其中$(S,T)$为流网络$G$的某一切割。

##### 基本的 Ford-Fulkerson 算法

伪码：

```c++
Ford-Fulkerson(G,s,t)
for each edge(u,v) 属于 G.E
      (u,v).f = 0
while there exists a path p from s to t in the residual network G_f
      c_f(p)=min(c_f(u,v):(u,v) is in p)
      for each edge(u,v) in p
              if(u,v) 属于 E
                   (u,v).f = (u,v).f + c_f(p)
              else 
              // 抵消操作
                   (u,v).f = (u.v).f - c_f(p)
```

 